<script>
  $('#ok').click(function(e){
    if(!confirm('Once a review has been submitted, you cannot edit it again')) {
      e.preventDefault();
      e.stopPropagation();
      return;
    }
  });
</script>

<h2>Analysis of your review</h2>
<p>Below we provided you with the auto-analysis results on the review you are about to submit. Please note
that after clicking the '<b>OK</b>' button, the peer-review will be displayed to reviewee, and you will not be able
to update it anymore. You can scroll down to see the button.</p>
<% answers = @response.scores %>
<div>
  <table style="margin-left: auto; margin-right: auto;">
    <tr>
      <th>Question</th>
      <th>Response</th>
      <% tag_prompt_deployments.each do |tag_prompt_deployment|  %>
        <td>
          <b><%= tag_prompt_deployment.tag_prompt.prompt %></b><br>
          (class avg=<%= tag_prompt_deployment.average_number_of_satisfied_comments %>/<%= answers.count %>)
        </td>
      <% end %>
    </tr>
    <% answers.each do |answer| %>
      <tr style="border-bottom: 1px solid lightgrey;">
        <td><%= answer.question.txt[0...50] + "..." %></td>
        <td><%= answer.plain_comments.html_safe %></td>
        <% tag_prompt_deployments.each do |tag_prompt_deployment|  %>
          <td>
            <% if answer.comments.present? %>
              <%= ReviewMetricsQuery.has?(tag_prompt_deployment.id, answer.id) ?
                      "<span style='color: green'>Yes</span><br>".html_safe :
                      "<span style='color: red'>No</span><br>".html_safe %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
    <!-- Empty row, the 'OK' button on the right -->
    <tr>
      <%= ("<td></td>" * (tag_prompt_deployments.length + 1)).html_safe %>
      <td style="text-align: right; padding-top: 10px">
        <form action="/response/<%= @response.id %>/confirm_submit" method="get">
          <a href="javascript:$('#modal-window').modal('hide')">Back</a>
          <input type="submit" value="OK" id="ok">
          <%= hidden_field_tag('return', @return) %>
        </form>
      </td>
    </tr>
  </table>
</div>

<h1>Edit an existing itemnaire's advice</h1>

<script>
  <% for item in @itemnaire.items %>
 <%= "var display_vertical_" + item.id.to_s + " = false;" %>
<% end %>

function show_vertical_items(item_id){
  // Delete the horizontal items
  horz = document.getElementById('horizontal_items_' + item_id);
  vert = document.getElementById('vertical_items_' + item_id);
  horz_items = horz.getElementsByTagName("input"); // get all the item text boxes
  vert_items = vert.getElementsByTagName("input");

  var i = 0;
  while(horz_items.length > 0)
    {
      // Copy the value before deleting the horizontal item
      vert_items[i].value = horz_items[0].value;
      horz_items[0].parentNode.removeChild(horz_items[0]);
      i++;
    }
}

function show_horizontal_items(item_id){
  vert = document.getElementById('vertical_items_' + item_id);
  vert_items = vert.getElementsByTagName("input");

  for(var i=0; i<vert_items.length; i++){
    var id = vert_items[i].id.split('_')[1];
    var col = document.getElementById('horizontal_item_'+item_id+'_'+i);
    col.innerHTML = '<input id="horizontal_' + id + '_advice" name="advice[' + id + '][advice]" size="12" type="text" value="' + vert_items[i].value + '"/>';
  }
}

</script>

<%= form_tag :action => 'save_advice', :id=>@itemnaire.id do %>
  <table>
    <tr>
      <% num_of_advices = @itemnaire.max_item_score-@itemnaire.min_item_score %>
      <% for i in (0..num_of_advices) %>
        <th>
          <%= @itemnaire.max_item_score-i %>
        </th>
      <% end %>
    </tr>
    <% for item in @itemnaire.items %>
      <% if item.is_a?(ScoredQuestion) %>
        <tr>
          <td colspan=<%= num_of_advices %>><b><%= item.txt %></b></td>
        </tr>
        <tr id="horizontal_items_<%= item.id %>">
          <% i = 0 %>
          <% for @advice in item.item_advices.sort {|x,y| y.score <=> x.score } %>
            <td id="horizontal_item_<%=item.id%>_<%=i%>">
              <% i = i + 1; %>
              <%= text_area('advice[]', 'advice', rows: 5, cols: 25, :id => "horizontal_"+@advice.id.to_s+"_advice")%>
            </td>
          <% end %>
        </tr>
      <% end %>
    <% end %>
  </table>
  <br>
  <%= submit_tag "Save and redisplay advice", :name=>"save_advice" %>
<% end %>
<br>
<%= link_to 'Back to itemnaire', :controller => 'itemnaires', :action => 'edit', :id => @itemnaire.id %>

<h2>Advertisements</h2>

<h2>Team members</h2>
<% if @student.team == nil %>
  You don't have a team yet!
<% else %>

  <b>Team Name: </b><%= @student.team.name(session[:ip]) %>

<%= link_to "Edit name",
  edit_student_teams_path(team_id: @student.team.id, student_id: @student.id) %>
<table>
  <tr>
    <td><b>Username &nbsp</b></td>
    <td><b>Full Name &nbsp</b></td>
    <td><b>Email &nbsp</b></td>
    <td></td>
  </tr>
  <% for member in @student.team.participants %>
    <tr>
      <td><%= member.user.username(session[:ip]) %></td>
      <td><%= member.user.name(session[:ip]) %></td>
      <td><%= member.user.email(session[:ip]) %></td>
      <% if @student.assignment.questionnaires.find_by_type('TeammateReviewQuestionnaire') != nil and member.user.id != session[:user].id %>

        <% map = TeammateReviewResponseMap.where(['reviewer_id = ? and reviewee_id = ?', @student.id, member.id]).first
        if map.nil?
          map = TeammateReviewResponseMap.create(:reviewer_id => @student.id, :reviewee_id => member.id, :reviewed_object_id => @student.assignment.id)
        end
        review = map.response.last
        if review.nil? %>
      <td>
        <%= link_to "Review", {:controller => 'response', :action => 'new', :id => map.map_id, :return => "teammate"} %>
      </td>
    <% else %>
      <td>
        <%= link_to "View", {:controller => 'response', :action => 'view', :id => review.response_id} %>
      </td>
      <td>
        <%= link_to "Edit", {:controller => 'response', :action => 'edit', :id => review.response_id, :return => "teammate"} %>
      </td>
    <% end %>
  <% end %>
</tr>
      <% end %>
    </table>
  <% end %>

<b>Hosted Documents</b>&nbsp;&nbsp;&nbsp;<a href="#" id="urlLink" name="urlLink" onClick="toggleElement('hosted_docs','links');return false;">toggle hosted documents</a><br/>
  <div id="hosted_docs" style="">
  <% if documents && documents.length > 0 %>
  <table id="hosteddocuments" cellpadding="0" cellspacing="0" border="0">
    <tr class="title">
      <th class="icon">&nbsp;</td>
      <th class="document-title">Title</td>
      <th class="service">Service</td>
      <th class="view" style="border-right:1px solid black;">Actions</td>
    </tr>
  <% documents.each_with_index{ | document, i | %>
    <tr class="<%= i % 2 ? 'even' : 'odd' %>">
      <td class="icon"><image src='/images/google/icon_6_<%= document.document_type ? document.document_type : 'generic' %>.gif'/></td>
      <td class="document-title"><%= document.label %></td>
      <td class="service"><%= document.service %></td>
      <td class="actions">
        <% if stage != "Complete" and controller.controller_name == 'submitted_content' %>
          <%= link_to "delete", {:action => 'remove_hosted_document', :id => document.id} %>|
        <%end %>
        <a href="<%= document.url %>" target="_blank">view</a></td>
    </tr>
  <% } %>
  </table>
  <% else %>
  <div style="font-style:italic;margin:1em;">No hosted documents submitted</div>
  <% end %>
<% if stage != "Complete" and controller.controller_name == 'submitted_content' %>
  <% if ! gdocs_authenticated %>
    <div class='flash_error' style="background-color:#fff;">
    <a href="javascript:void(0)" onclick="<%= gdocs_authentication_link %>"><image style="border:none;" src="/images/google/docs_logo_disabled_sm.gif" title="Not authenticated"/></a>
    <p>The greyed out logo indicates Expertiza is not currently authenticated to work with Google Docs.  Please click the Authenticate link to redirect this page to a Google Docs page giving Expertiza access to work with the Google Docs API.</P>
    <a href="<%= gdocs_authentication_link %>">Authenticate</a>
    </div>
  <% else %>
    <div class='flash_note' style="background-color:#fff;">
    <a href="javascript:void(0)" onclick="load_gdocs();"><image style="border:none;" src="/images/google/docs_logo_sm.gif" title="Reload Google Docs"/></a>
    <p>The colored logo indicates Expertiza is currently authenticated to work with Google Docs.  The list of Google Docs will automatically be loaded, but may be reloaded by clicking the Reload link.  To select a document for uploading just click the document's name and then the Submit Document button.</p>
    <p>Note: Only the first 100 documents from the repository are retrieved.<p>
    <a href="javascript:void(0)" onclick="load_gdocs();">Reload</a>
    </div>
    <script type="text/javascript">window.onload = function(){load_gdocs();}</script>
    <table id="googledocs" cellspacing="0" cellpadding="0" border="0">
    </table>
    <% form_tag :action=>'submit_hosted_document', :id => participant_id do %>
      <!--
      <div>Submit a Hosted Document (optional):</div>
      <table cellpadding="0" cellspacing="0" border="0"><tr>
      <td><label for="doc_label">Label:&nbsp;</label></td>
      <td><input id="doc_label" type="text" name="doc_label" size=40/></td>
      </tr><tr>
      <td><label for="doc_url">URL:&nbsp;</label></td>
      <td><input id="doc_url" type="text" readonly="true" name="doc_url" size=40/></td>
      </tr><tr>
      <td><label for="doc_service">Service:&nbsp;</label></td>
      <td><input id="doc_service" type="text" name="doc_service" size=40/></td>
      </tr><tr>
      <td><label for="doc_type">Type:&nbsp;</label></td>
      <td><input id="doc_type" type="text" name="doc_type" size=40/></td>
      </tr><tr>
      <td colspan="2"><input type="submit" name="submit" value="Submit Document"/></td>
      </tr></table>
      -->
      <input id="doc_label" type="hidden" name="doc_label" size=40/>
      <input id="doc_url" type="hidden" readonly="true" name="doc_url" size=40/>
      <input id="doc_service" type="hidden" name="doc_service" size=40/>
      <input id="doc_type" type="hidden" name="doc_type" size=40/>
      <input type="submit" name="submit" value="Submit Document"/>
    <% end %>
  <% end %>
<% end %>
</div>
<br/><br/>
<style type="text/css">
#hosteddocuments {border-top:1px solid #000;border-left:1px solid #000;margin:1em;width:80%}
#hosteddocuments td {border-bottom:1px solid #000;padding:3px;}
#hosteddocuments th {border-bottom:1px solid #000;padding:3px;}
#googledocs {border-top:1px solid #000;border-left:1px solid #000;margin:1em;width:80%}
#googledocs td {border-bottom:1px solid #000;padding:3px;}
#googledocs th {border-bottom:1px solid #000;padding:3px;}
.icon {width:16px;border-right:none;}
.document-title {border-right:none;}
.service {border-right:none;text-align:center;}
.actions {text-align:center;border-right:1px solid black;}
.title {background-color:#ccc;}
.selected {background-color:#ccf;}
</style>
<script type="text/javascript">
function load_gdocs() {
    //document.getElementById('googledocs').display = 'block';
    document.getElementById('googledocs').innerHTML = "<tr><td style='border-right:1px solid black;'><i>Loading...</i></td></tr>";
    new Ajax.Request("<%= url_for :controller=>'google_docs', :action=>'documents', :format => 'xml' %>",
        {
            method:'get',
            onSuccess: function(transport) {
                if (transport.responseXML) {
                try {
                    var docList = "<tr class='title'><th class='icon'>&nbsp;</th><th class='icon'>&nbsp;</th><th class='document-title'>Title</th><th class='service'>Service</th><th class='view' style='border-right:1px solid black;'>Actions</th></tr>";
                    var records = transport.responseXML.getElementsByTagName("record");
                    for ( i = 0; i < records.length; ++i ) {
                        var title = get_text(records[i],"title");
                        var alternate = get_text(records[i],"alternate");
						//var alternate = get_text(records[i],"content");
                        var doc_type = get_text(records[i],"document-type");
                        docList += "<tr class='"+((i+1)%2?'even':'odd')+"'>" +
                        "<td class='icon'><input type='radio' id='button"+(i+1)+"' name='gdocs' value='"+(i+1)+"' onclick=\"highlight_and_select("+(i+1)+", '" + title + "','" + alternate + "','Google','" + doc_type + "');\"/></td>" +
                        "<td class='icon'><image src='/images/google/icon_6_" + doc_type + ".gif'/></td>" +
                        "<td class='document-title'><a href='javascript:void(0)'" +
                        "onclick=\"highlight_and_select("+(i+1)+", '" + title + "','" + alternate + "','Google','" + doc_type + "');\">" + get_text(records[i],"title") +
                        "</a></td>" +
                        "<td class='service'>Google</td>" +
                        "<td class='actions'><a target='_blank' href='"+alternate+"'>view</a></td>" +
                        "</tr>\n";

                        //"onclick=\"select_doc('" + title + "','" + alternate + "','Google','" + doc_type + "')\">" + get_text(records[i],"title") +
                    }
                    document.getElementById('googledocs').innerHTML = docList;
                } catch (e) {
                    alert('An error occurred processing the list of Google Docs:\n'+e);
                    document.getElementById('googledocs').innerHTML = "<tr><td style='border-right:1px solid black;'><span style='font-style:italic;font-weight:bold;color:red;'>An error occurred</span></td></tr>";
                }
                }
            },
            onFailure: function() {
                alert('An error occurred retrieving the list of Google Docs');
                document.getElementById('googledocs').innerHTML = "<tr><td style='border-right:1px solid black;'><span style='font-style:italic;font-weight:bold;color:red;'>An error occurred</span></td></tr>";
            }
        });
}
function get_text(record, name) {
    return record.getElementsByTagName(name)[0].childNodes[0].nodeValue;
}
function select_doc(title, link, service, type) {
    document.getElementById('doc_label').value = title;
    document.getElementById('doc_url').value = link;
    document.getElementById('doc_service').value = service;
    document.getElementById('doc_type').value = type;
}
var selected_row = -1;
function highlight_and_select(row, title, link, service, type) {
    var table = document.getElementById('googledocs');
    if ( -1 != selected_row ) {
        table.getElementsByTagName('tr')[selected_row].className = (selected_row%2?'even':'odd');
        selected_row = -1;
    }
    var rowEl = table.getElementsByTagName('tr')[row];
    rowEl.className = 'selected';
    select_doc(title, link, service, type);
    document.getElementById('button'+row).checked = true;
    selected_row = row;
}
</script>
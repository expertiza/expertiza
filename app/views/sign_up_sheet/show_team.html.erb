<h2>
  Partner Advertisements for Topic: <%= SignUpTopic.find(params[:id]).topic_name %>
</h2>

<table class="general">
  <tr>
    <th width="500">Team Name</th>
    <th width="500">Members</th>
    <th width="500">Desired Qualifications</th>
    <th width="500">Action</th>
  </tr>

  <% count=0 %>
  <%# @results is the ad_info for an assignment's topic %>
  <% @results.each {|result| %>
    <% ad_request = JoinTeamRequest.where(team_id: result[:team_id], participant_id: session[:user].id).first %>
    <% puts ad_request %>
    <%
      team_members = []
      TeamsUser.where(team_id: result[:team_id]).each{|teamuser|
        team_members << User.find(teamuser.user_id).name
      }
      if result[:advertise_for_partner]|| result[:advertise_for_partner] == 1
    %>
      <tr>
        <td align="center" width="500"><%= result[:name] %></td>
        <td align="center" width="500"><%= team_members.join(', ') %></td>
        <td align="center" width="500"><%= result[:comments_for_advertisement] %></td>
        <% if  Participant.where(parent_id: result[:assignment_id], user_id: session[:user].id).first && ad_request.nil? %>
          <td align="center"><%= link_to "Request invitation", :controller => 'join_team_requests', :action => 'new',
            :assignment_id=>result[:assignment_id],
            :topic_id=>result[:topic_id],
            :team_id=>result[:team_id]
          %>
          <img src="/assets/info.png" title="Send request to join this team">
          </td>
        <% else %>
          <% if team_members.include?(session[:user].name) %>
            <td align="center"><img src="/assets/info.png" title="You're a member of this team and cannot request to join!"></td>
          <% else %>
            <td align="center"><%= link_to "Edit invitation", :controller => 'join_team_requests', :action => 'edit',
                  :id=>ad_request.id
                %>
              <img src="/assets/info.png" title="Edit your request to join this team">
            </td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  <% } %>

</table>







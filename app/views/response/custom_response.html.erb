 <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" rel="stylesheet" type="text/css"/>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6/jquery.min.js"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
 
  <script>
  $(document).ready(function() {
    $("#accordion").accordion({ autoHeight: false });
  });
  </script>
 <h1><%= @header %> <%= @title %> for <%= @map.assignment.name %></h1>
 <% if !@map.contributor.nil?   %>
     <% if !@topic_id.nil? %>
              <h2>You are reviewing <%= @signedUpTopic %></h2>
      <% end %>
      <%= render :partial => 'submitted_content/main', :locals => {:participant => @map.contributor, :stage =>  @assignment.get_current_stage()} %>
 <% end %>

<%= @map.show_review() %>


 <%
 #TODO: Put this in some other place    
 def label(object_name, method, label)
    content_tag(:label, h(label), :for => "#{object_name}_#{method}")
  end
 %>

 <%= form_tag :action => @next_action, :id => @modified_object %>

 <div id="accordion">
   <h3><a href="#"><b>Learning Targets</b></a></h3>
   <div>
     <p>
        Check the descriptions that are true of the article's learning targets:
       <% [0,1,2,3].each do |i| %>
       <%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %>
       <% end %>
       <%= render :partial => "textfield", :locals => {:ques_num => 4, :field_size => 3, :ques_text => "Number of learning targets:"} %>

	<% grades = 0, 1, 2, 3, 4, 5 %>

        <p><%=label("custom_response", "5", "Assign a grade for the learning targets: ")%>
          <% if controller.action_name == 'new' %>
            <%= select_tag "custom_response[5]", options_for_select(grades,nil)%>
          <% else %>
            <%= select_tag "custom_response[5]", options_for_select(grades,@review_scores[5].comments.gsub(/\"/,'&quot;').to_i)%>
          <% end %>
        </p>

        <%= render :partial => "textarea", :locals => {:ques_num => 6, :area_size => "40x5", :ques_text => "Please make a comment about your rating. Provide suggestions for how the author can improve their learning targets:"} %>
   </div>
   <h3><a href="#"><b>Content</b></a></h3>
   <div>
     <p>Copy (Ctrl + C) and paste (Ctrl + V) the text of the article into a Word document (you can also use <a href="http://www.openoffice.org">Open Office</a>, a free alternative to Microsoft Word). Use track changes and/or comments (<font color="blue"><a href="http://www.ehow.com/how_2136058_use-track-changes-word.html">Learn How</a></font>) to suggest changes or additions. Save your file in MS Word 97-2003 compatible format (as a .doc) and upload it below.</p>
     <p>In addition to correcting grammar etc, suggest places where clarification, examples and explanations can be added. Point out where visual or interactive elements can be introduced. Discuss whether the information included was important, interesting, engaging. Suggest what could be omitted or added.</p>
     <p><b><font color='red' size ="4">WARNING!!</font> You must save your review 
		       <font size="3"><u>BEFORE</u></font> you upload a file. Any text that has not been saved 
					 <font size="3"><u>WILL BE LOST</u></font> when you click on the Upload File link. 
					 </b>To save your review, click Save Review at the bottom of this page.  
					 <font size="2"><i>(If you forget to save before uploading a file, you should be able to recover your text by hitting the back button twice.)</i></font></p>
        <b><%=label("custom_response", "7", "File:")%></b>
        <%  @current_folder = DisplayOption.new
            @current_folder.name = "" %>
            <% files_list = Dir[@participant.assignment.get_path.to_s+ "/" +@map.id.to_s + @current_folder.name + "/*"]
            files = Array.new
            for file in files_list
                if File.directory?(file) then
                    dir_files = get_files(file)
                    dir_files.each{|f| files << f}
                end
                files << file
            end
            file = files[0]
            if !file.nil?
                parentFolder = File.dirname(file)
                location = parentFolder + File.basename(file)
                %><u><i><%=link_to File.basename(file), :controller => 'submitted_content', :action => 'download', :download => File.basename(file), "current_folder[name]" =>  File.dirname(file)%></i></u>
            <% end %>&nbsp &nbsp &nbsp &nbsp &nbsp&nbsp
            <%if @map.response.nil?
                return_to = "new"
             else
                return_to ="edit"
             end
            %>
            <%=link_to('Upload File', :action=>'upload', :participant_id => @participant.id, :map => @map.id, :id=>params[:id], :return_to => return_to)%>
    <br>
    <table>
      <tr>
        <% [8,9].each do |i| %>
         <td><%= render :partial => "textarea", :locals => {:ques_num => i, :area_size => "50x5", :ques_text => load_questions(i)} %></td>
        <% end  %>
      </tr>
      <tr>
        <% [10,11].each do |i| %>
         <td><%= render :partial => "textarea", :locals => {:ques_num => i, :area_size => "50x5", :ques_text => load_questions(i)} %></td>
        <% end  %>
      </tr>
    </table>
  </div>

   <%#**************************SOURCES**************************%>
   <h3><a href="#"><b>Sources</b></a></h3>
   <div>
     <%= render :partial => "textfield", :locals => {:ques_num => 12, :field_size => 3, :ques_text => load_questions(12)} %>

     <p><%=label("custom_response", "13", "List the range of publication years for all sources, e.g. 1998-2006:")%>
      <%= render :partial => "textfield_inline", :locals => {:ques_num => 13, :field_size => 3} %>
      - <%= render :partial => "textfield_inline", :locals => {:ques_num => 14, :field_size => 3} %>
     </p>

     Check the descriptions that are true of the article:
     <% [15,16,17,18,19,20,21].each do |i| %>
        <%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %>
     <% end  %>
     <% i = 22 %>
     <%= render :partial => "textarea", :locals => {:ques_num => i, :area_size => "40x5", :ques_text => load_questions(i)} %>
     <% i+= 1 %>
     <%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %>
     <% [24,25].each do |i| %>
        <%= render :partial => "textarea", :locals => {:ques_num => i, :area_size => "40x5", :ques_text => load_questions(i)} %>
     <% end  %>

   </div>

   <%#**************************MULTIPLE-CHOICE**************************%>
   <h3><a href="#"><b>Multiple-Choice Questions</b></a></h3>

   <div>
     Check the descriptions that are true of the multiple-choice questions:
     <% [26,27,28,29,30,31,32,33].each do |i| %>
        <%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %>
     <% end  %>


     <%  types = Array.new
         types[0] = "Knowledge"
         types[1] = "Application"
     %>
     <p>
    	  <% for i in [34, 37, 40, 43] %>
    	    <%= render :partial => "rating", :locals => {:ques_num => i, :size => "60x5", :dropdown1_title => "Type:", :selections => types, :dropdown2_title => "Grade:", :grades => grades} %>
    	  <% end %>
     </p>
   </div>

   <h3><a href="#"><b>Rubric</b></a></h3>
   <div>
     Please check selections that apply to the article.
     <p><b>Importance</b></p>
     <hr>
     <div align="center">The information selected by the author:</div>
     <table class='general'>
        <tr>
          <th cellspacing="20%">5 - Very Important   </th>
          <th cellspacing="20%">4 - Quite Important  </th>
          <th cellspacing="20%">3 - Some Importance  </th>
          <th cellspacing="20%">2 - Little Importance</th>
          <th cellspacing="20%">1 - No Importance    </th>
        </tr>
        <tr>
          <% [46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65].each do |i| %>
            <% if  ((i-46)%4) == 0 %>
                <td> <ul>
            <% end  %>
            <li><p><%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %></p></li>
            <% if  ((i>=49) && ((i-49)%4) == 0) %>
                </ul> </td>
            <% end  %>
          <% end %>
        </tr>
     </table>

     <p><b>Interest</b></p>
     <hr>
     <div align="center">To attract and maintain attention, the article has:</div>
     <table class='general'>
        <tr>
          <th cellspacing="20%">5 - Extremely Interesting   </th>
          <th cellspacing="20%">4 - Quite Interesting  </th>
          <th cellspacing="20%">3 - Reasonably Interesting  </th>
          <th cellspacing="20%">2 - Little Interest</th>
          <th cellspacing="20%">1 - No Interest    </th>
        </tr>

       <tr>
          <% [66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90].each do |i| %>
            <% if  ((i-66)%5) == 0 %>
                <td> <ul>
            <% end  %>
            <li><p><%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %></p></li>
            <% if  ((i>=70) && ((i-70)%5) == 0) %>
                </ul> </td>
            <% end  %>
          <% end %>
       </tr>
     </table>

     <p><b>Credibility</b></p>
     <hr>
     <div align="center">To demonstrate its credibility the article:</div>
     <table class='general'>
        <tr>
          <th cellspacing="20%">5 - Completely Credible   </th>
          <th cellspacing="20%">4 - Substantial Credibility  </th>
          <th cellspacing="20%">3 - Reasonable Credibility </th>
          <th cellspacing="20%">2 - Limited Credibility</th>
          <th cellspacing="20%">1 - Not Credible   </th>
        </tr>
        <tr>
          <% [91,92,93,94,95,96,97,98,99,100,101,102,103,104,105].each do |i| %>
            <% if  ((i-91)%3) == 0 %>
                <td> <ul>
            <% end  %>
            <li><p><%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %></p></li>
            <% if  ((i>=93) && ((i-93)%3) == 0) %>
                </ul> </td>
            <% end  %>
          <% end %>
          </tr>
     </table>

     <p><b>Pedagogy</b></p>
     <hr>
     <div align="center">To help guide the reader:</div>
     <table class='general'>
        <tr>
          <th cellspacing="20%">5 - Superior   </th>
          <th cellspacing="20%">4 - Effective  </th>
          <th cellspacing="20%">3 - Acceptable </th>
          <th cellspacing="20%">2 - Deficient</th>
          <th cellspacing="20%">1 - Absent   </th>
        </tr>
       <tr>
          <% [106,107,108,109,110,111,112,113,114,115,116,117,118,119,120].each do |i| %>
            <% if  ((i-106)%3) == 0 %>
                <td> <ul>
            <% end  %>
            <li><p><%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %></p></li>
            <% if  ((i>=108) && ((i-108)%3) == 0) %>
                </ul> </td>
            <% end  %>
          <% end %>
      </tr>
     </table>
     <p><b>Writing Quality</b></p>
     <hr>
     <div align="center">The writing:</div>
     <table class='general'>
        <tr>
          <th cellspacing="20%">5 - Excellently Written   </th>
          <th cellspacing="20%">4 - Well Written  </th>
          <th cellspacing="20%">3 - Reasonably Written  </th>
          <th cellspacing="20%">2 - Fairly Written</th>
          <th cellspacing="20%">1 - Poorly Written    </th>
        </tr>
       <tr>
          <% [121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140].each do |i| %>
            <% if  ((i-121)%4) == 0 %>
                <td> <ul>
            <% end  %>
            <li><p><%= render :partial => "checkbox", :locals => {:ques_num => i, :ques_text => load_questions(i)} %></p></li>
            <% if  ((i>=124) && ((i-124)%4) == 0) %>
                </ul> </td>
            <% end  %>
          <% end %>
      </tr>
     </table>
   </div>

<h3><a href="#"><b>Ratings</b></a></h3>
   <div>
     Provide a rating and justification for each criterion:     
     <table cellpadding="5">
       <tr>
            <td><b>Importance:</b>
						     <%= render :partial => "rating", :locals => {:ques_num => 141, :size => "40x5", :dropdown1_title => nil, :dropdown2_title => "Rating:", :grades => grades} %>
            </td>
            <td><b>Interest:</b>
                 <%= render :partial => "rating", :locals => {:ques_num => 143, :size => "40x5", :dropdown1_title => nil, :dropdown2_title => "Rating:", :grades => grades} %>
            </td>
       <tr>
       <tr>
            <td><b>Credibility:</b>
                 <%= render :partial => "rating", :locals => {:ques_num => 145, :size => "40x5", :dropdown1_title => nil, :dropdown2_title => "Rating:", :grades => grades} %>
            </td>
            <td><b>Pedagogy:</b>
                 <%= render :partial => "rating", :locals => {:ques_num => 147, :size => "40x5", :dropdown1_title => nil, :dropdown2_title => "Rating:", :grades => grades} %>
            </td>
       <tr>
       <tr>
            <td><b>Writing:</b>
                 <%= render :partial => "rating", :locals => {:ques_num => 149, :size => "40x5", :dropdown1_title => nil, :dropdown2_title => "Rating:", :grades => grades} %>
            </td>
       </tr>
     </table>
   </div>
 </div>
 <br/>
 <%= submit_tag "Save "+@title, :name=>"save" %>
</form>
<h2> Review scores: <%= Participant.find(@reviewer_id).name %> </h2>

<% keys = @review_final_versions.keys %>
<% keys.each do |key| %>
    <br>
    <hr>
    <h4>Course: <%= Assignment.find(@assignment_id).course.name %></h4>
    <h4> Assignment: <%= Assignment.find(@assignment_id).name %></h4>
    <% roundtitle = key.to_s %>
    <h4><%= roundtitle.titlecase %></h4>

    <table class="general" border="1">
      <% questionnaire_id = Questionnaire.find(@review_final_versions[key][:questionnaire_id]) %>
      <% questions = Question.where(questionnaire_id: questionnaire_id) %>
      <% num_responses = @review_final_versions[key][:response_ids].length %>
      <% responses = @review_final_versions[key][:response_ids] %>
      <!--      set column length of responses-->
      <% col_percent = 100/num_responses%>
      <% col_percent_comment = 100/num_responses - 1%>
      <!-- show the team which did the review -->
      <tr>
        <th colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%" > <b>QUESTION</b> </th>
        <td colspan="3" style="padding: 0px;" width="(100-<%= col_percent %>)%">
          <table width="100%">
            <tr>
              <% responses.each do |response_id| %>
                  <% team = Team.find(ResponseMap.find(Response.find(response_id).map_id).reviewee_id) %>
                  <td> <b><%= team.name %></b> <div style ="font-size:11px"> done at -- <%= Response.find(response_id).updated_at.strftime("%a, %b %d, %Y %I:%M:%S %p") %> &nbsp&nbsp</div></td>
              <% end %>
            </tr>
          </table>
        </td>

      </tr>
      <% questions.each do |question| %>
          <% if !question.is_a?(QuestionnaireHeader) && num_responses > 0 %>
              <tr>
                <th colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%" > <%= question.txt %></th>
                <% if question.instance_of? Checkbox %>
                    <!-- Show review summary of checkbox question -->
                    <td colspan="3" style="padding: 0px;" width="100-<%= col_percent %>%">
                      <%= render :partial => 'checkbox_question_review', :locals => {:question => question, :responses => responses} %> 
                    </td>
                  
                <% else %><!-- Show review summary of a non checkbox question -->
                   <td colspan="3" style="padding: 0px;" width="100-<%= col_percent %>%"> 
                      <%= render :partial => 'non_checkbox_question_review', :locals => {:question => question, :responses => responses} %> 
                   </td>
                   </tr>
              <% end %>
          <% else %>
              <% next %>
          <% end %>
      <% end %>



      <tr>
        <th colspan="3" style="background-color:#DDDDBB" width="<%= col_percent %>%" >Additional Comments </th>
        <td colspan="3" style="padding: 0px;" width="(100-<%= col_percent %>)%">
          <table width="100%">
            <tr>
              <% responses.each do |response_id| %>
                  <% team = Team.find(ResponseMap.find(Response.find(response_id).map_id).reviewee_id) %>
                  <td colspan="2"> <%=sanitize Response.find(response_id).additional_comment %> </td>
              <% end %>
            </tr>
          </table>
        </td>
      </tr>
    </table>

<% end #loop for keys %>
<br/>
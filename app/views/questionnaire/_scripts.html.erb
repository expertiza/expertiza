<script type="text/javascript">
num_questions = <%= [@questionnaire.questions.length,0].max %>;
 number=num_questions;
var position_value;
var new_position;
var curr_loop_value;
var none;
var flag=0;
function deleteQuestions(){

	var checkedObjArray = new Array();
	var deleteCount = 0;
	var tbl = document.getElementById("questions_table");
	var numChecks = 0;

	for(i=0; i<document.forms[0].elements.length; i++){
		    if(document.forms[0].elements[i].type=="checkbox" &&
		    document.forms[0].elements[i].id.substring(0,12)=="question_chk"){

                numChecks++;
        	    if(document.forms[0].elements[i].checked==true){
				    num_questions--;
                    tbl.deleteRow(numChecks+1);

                    var drop_down=document.getElementById("previous_questions")
                    for(i=0;i<drop_down.length;i++)
                    {
                        if(drop_down.options[i].value==numChecks)
                             drop_down.remove(i);
                    }
                    for(i=0;i<drop_down.length;i++)
                    {
                        if(drop_down.options[i].value>=numChecks)
                        {
                                              drop_down.options[i].value=parseInt(drop_down.options[i].value)-1;
                        }
                    }
                    for(j=0; j<document.forms[0].elements.length; j++){
	                	if(document.forms[0].elements[j].type=="hidden" &&
		                (document.forms[0].elements[j].id.indexOf("_position_num")!=-1) &&
                        document.forms[0].elements[j].value>=parseInt(numChecks+1))
                        {
                                var temp=document.getElementById(document.forms[0].elements[j].id);
                                for(p2=0; p2<document.forms[0].elements.length; p2++){
                                        if(document.forms[0].elements[p2].type=="button")
                                        {
                                            if(parseInt(document.forms[0].elements[p2].id)==parseInt(temp.value)-1){
                                                        var temp1=  document.getElementById(document.forms[0].elements[p2].id);
                                                        temp1.id=parseInt(temp1.id)-1;
                                            }
                                        }
                                }
                                var tempvalue=parseInt(temp.value);
                                temp.value=tempvalue-1;
                        }
                    }
                numChecks = 0;
				deleteQuestions();
			}
		}
	}
}

function addQuestions(){

    if(parseInt(document.forms[0].previous_questions.length)!=0){
        var position_number=parseInt(document.getElementById("previous_questions").value);

        var buttons_present=document.getElementsByName("position");
        for(i=0;i<buttons_present.length;i++)
        {

            if(buttons_present[i].checked)
            {
                if(buttons_present[i].value=="before")
                        position_value=2+position_number-1;
                if(buttons_present[i].value=="after")
                        position_value=2+position_number;
            }
        }
    }

    numQuestionsToAdd = parseInt(document.getElementById("numQuestionsToAdd").value);
    for(i=0; i<numQuestionsToAdd; i++){
		curr_loop_value=i;
        addQuestion();
	}

    if(parseInt(document.forms[0].previous_questions.length)!=0){
     for(i=0; i<document.forms[0].elements.length; i++){
		if(document.forms[0].elements[i].type=="hidden" &&
		   document.forms[0].elements[i].id.indexOf("_position_num")!=-1 &&
           document.forms[0].elements[i].value>=new_position-parseInt(curr_loop_value))
        {
            if(flag<numQuestionsToAdd)
                    flag=flag+1;
            else
            {
                    var temp=document.getElementById(document.forms[0].elements[i].id);
                    var temp_value=parseInt(temp.value)
                    temp.value=temp_value+numQuestionsToAdd;
            }
        }
    }
    flag=0;

    for(i=0; i<document.forms[0].elements.length; i++){
		if(document.forms[0].elements[i].type=="button" &&
           parseInt(document.forms[0].elements[i].id)>=new_position-parseInt(curr_loop_value)-1)
        {

            if(flag<numQuestionsToAdd*2)
                    flag=flag+1;
            else
            {

                    var temp=parseInt(document.forms[0].elements[i].id);
                    var temp_value=parseInt(temp)
                    document.forms[0].elements[i].id=temp_value+numQuestionsToAdd;

            }
        }
    }
    flag=0;

    }

    var drop_down=document.getElementById("previous_questions")
                for(i=0;i<drop_down.length;i++)
                {
                    if(drop_down.options[i].value>=new_position-parseInt(curr_loop_value)){
                         drop_down.options[i].value=parseInt(drop_down.options[i].value)+numQuestionsToAdd;
                    }
                }
}

function addQuestion(){

    number=number+1;
    table = document.getElementById("questions_table");

    if(parseInt(document.forms[0].previous_questions.length)==0)
        var row = table.insertRow(-1);
    else
	    var row = table.insertRow(position_value+curr_loop_value);
	
	id = num_questions;

    column = document.createElement("td");
	column.innerHTML = "<input type=checkbox id='question_chk" + num_questions + "'>";
	row.appendChild(column);
	
	column = document.createElement("td");
	column.innerHTML = "<input id=new_question_" + id + "_txt name=new_question[" + id + "][txt] size=70 type=hidden/>";
	row.appendChild(column);
	
	column = document.createElement("td");
	gradingTypes = "<select id=question_" + id + "_true_false name=new_question[" + id + "][true_false]>";
	<% for type in Question::GRADING_TYPES %>
		<%= "gradingTypes += '<option value=" + type[1].to_s + ">" + type[0].to_s + "</option>';"%>
	<% end %>
	gradingTypes += "</select>"
	column.innerHTML = gradingTypes;
	row.appendChild(column);

	column = document.createElement("td");
	weights = "<select id=new_question_" + id + "_weight name=new_question[" + id + 		"][weight]>";
	<% for weight in Question::WEIGHTS %>
		<%= "weights += '<option value=" + weight[1].to_s + ">" + weight[0].to_s + "</option>';"%>
	<% end %>
	weights = weights + "</select>";
	column.innerHTML = weights;
	row.appendChild(column);
	num_questions = num_questions + 1;


    new_position=parseInt(position_value-1);
    new_position=parseInt(curr_loop_value)+new_position;
    var check=num_questions;
    if(parseInt(document.forms[0].previous_questions.length)==0)
    {



            column = document.createElement("td");
                        tableID="questions_table";

                        column.innerHTML="<input type=button value='Move Up' id="+(parseInt(num_questions)-1)+" onclick='reorder(tableID,this.id)' />"
        row.appendChild(column);

        column = document.createElement("td");
                 tableID="questions_table";

                 column.innerHTML="<input type=button value='Move Down' id="+(parseInt(num_questions)-1)+" onclick='reorderdown(tableID,this.id)' />"
                 row.appendChild(column);
         column = document.createElement("td");
        column.innerHTML = "<input value="+parseInt(check)+" id=new_question_"+ number +"_position_num  name=new_question[" + id + "][position_num]  type=hidden />";
            row.appendChild(column);

    }
    else
    {



    column = document.createElement("td");
                tableID="questions_table";

                column.innerHTML="<input type=button value='Move Up' id="+(parseInt(new_position)-1)+" onclick='reorder(tableID,this.id)' />"
        row.appendChild(column);

        column = document.createElement("td");
                 tableID="questions_table";

                 column.innerHTML="<input type=button value='Move Down' id="+(parseInt(new_position)-1)+" onclick='reorderdown(tableID,this.id)' />"
                 row.appendChild(column);
         column = document.createElement("td");
	column.innerHTML = "<input value="+new_position+" id=new_question_"+ number +"_position_num  name=new_question[" + id + "][position_num] type=hidden />";
	row.appendChild(column);

    }

}


function reorderdown(tableID,jid)
{

    if(jid!=num_questions)
{
    var id=parseInt(jid);
    var i=id+2;
    var j=id+3;
   	var table = document.getElementById(tableID);
	var trs = table.tBodies[0].getElementsByTagName("tr");

	if(i == j+1) {
		table.tBodies[0].insertBefore(trs[i], trs[j]);
	} else if(j == i+1) {
		table.tBodies[0].insertBefore(trs[j], trs[i]);
	} else {

		var tmpNode = table.tBodies[0].replaceChild(trs[i], trs[j]);
		if(typeof(trs[i]) != "undefined") {
			table.tBodies[0].insertBefore(tmpNode, trs[i]);
		} else {
			table.appendChild(tmpNode);
		}
	}
    var k=id+1;


    for(i=0; i<document.forms[0].elements.length; i++){

                 if(document.forms[0].elements[i].type=="hidden" &&
		   (document.forms[0].elements[i].id.indexOf("_position_num")!=-1) &&
           document.forms[0].elements[i].value==parseInt(jid)+1)
                 {

           var try1=document.getElementById(document.forms[0].elements[i].id);

                      for(k11=0; k11<document.forms[0].elements.length; k11++){
                 if(document.forms[0].elements[k11].type=="hidden" &&
		   (document.forms[0].elements[k11].id.indexOf("_position_num")!=-1) &&
           document.forms[0].elements[k11].value==(parseInt(jid)+2))
                 {

                      var try2= document.getElementById(document.forms[0].elements[k11].id);

                        try2.value=parseInt(try2.value)-1;
                     try1.value=parseInt(try1.value)+1;
                 }
                      }

                 }


    }
          var a1=new Array(2);
    var  s=0;
        for(p22=0; p22<document.forms[0].elements.length; p22++){
                    if(document.forms[0].elements[p22].type=="button")
                 {
                    if(parseInt(document.forms[0].elements[p22].id)==id)
                 {
                     a1[s]=  p22;
                     s++;
                 }
                 }
        }



       var a11=new Array(2);
    var  s1=0;
        for(p23=0; p23<document.forms[0].elements.length; p23++){


                 if(document.forms[0].elements[p23].type=="button" &&
		   (parseInt(document.forms[0].elements[p23].id)==(parseInt(jid)+1)))
                 {

                    a11[s1]=  p23;
                     s1++;
                 }
        }


    document.forms[0].elements[a11[0]].id=parseInt(document.forms[0].elements[a11[0]].id)-1;

    document.forms[0].elements[a11[1]].id=parseInt( document.forms[0].elements[a11[1]].id)-1;

    document.forms[0].elements[a1[0]].id=parseInt(document.forms[0].elements[a1[0]].id)+1;

    document.forms[0].elements[a1[1]].id=parseInt(document.forms[0].elements[a1[1]].id)+1


    var drop_down=document.getElementById("previous_questions")
    var temp_arr=new Array(2);
    for(i=0;i<drop_down.length;i++){
                    var temp=parseInt(jid);
                    if(drop_down.options[i].value==temp+1){
                              temp_arr[0]=i;
                    }
                    if(drop_down.options[i].value==temp+2){
                                temp_arr[1]=i;
                    }
    }
                drop_down.options[temp_arr[0]].value=parseInt(drop_down.options[temp_arr[0]].value)+1;
                drop_down.options[temp_arr[1]].value=parseInt(drop_down.options[temp_arr[1]].value)-1;


}
}
 function reorder(tableID,jid)
{

    if(jid!=0)
{
    var id=parseInt(jid);
    var i=id+1;
    var j=id+2;
   	var table = document.getElementById(tableID);
	var trs = table.tBodies[0].getElementsByTagName("tr");

	if(i == j+1) {
		table.tBodies[0].insertBefore(trs[i], trs[j]);
	} else if(j == i+1) {
		table.tBodies[0].insertBefore(trs[j], trs[i]);
	} else {

		var tmpNode = table.tBodies[0].replaceChild(trs[i], trs[j]);
		if(typeof(trs[i]) != "undefined") {
			table.tBodies[0].insertBefore(tmpNode, trs[i]);
		} else {
			table.appendChild(tmpNode);
		}
	}
    var k=id-1;


    for(i=0; i<document.forms[0].elements.length; i++){

                 if(document.forms[0].elements[i].type=="hidden" &&
		   (document.forms[0].elements[i].id.indexOf("_position_num")!=-1) &&
           document.forms[0].elements[i].value==(jid))
                 {

           var try1=document.getElementById(document.forms[0].elements[i].id);

                      for(k11=0; k11<document.forms[0].elements.length; k11++){
                 if(document.forms[0].elements[k11].type=="hidden" &&
		   (document.forms[0].elements[k11].id.indexOf("_position_num")!=-1) &&
           document.forms[0].elements[k11].value==(parseInt(jid)+1))
                 {

                      var try2= document.getElementById(document.forms[0].elements[k11].id);

                        try2.value=parseInt(try2.value)-1;
                 }
                      }

                     try1.value=parseInt(try1.value)+1;
                 }


    }








         var a1=new Array(2);
    var  s=0;
        for(p22=0; p22<document.forms[0].elements.length; p22++){
                    if(document.forms[0].elements[p22].type=="button")
                 {
                    if(parseInt(document.forms[0].elements[p22].id)==parseInt(jid))
                 {
                     a1[s]=  p22;
                     s++;
                 }
                 }
        }



       var a11=new Array(2);
    var  s1=0;
        for(p23=0; p23<document.forms[0].elements.length; p23++){

                 if(document.forms[0].elements[p23].type=="button" &&
		   (parseInt(document.forms[0].elements[p23].id)==(parseInt(jid)-1)))
                 {

                    a11[s1]=  p23;
                     s1++;
                 }
        }

    document.forms[0].elements[a11[0]].id=parseInt(document.forms[0].elements[a11[0]].id)+1;

    document.forms[0].elements[a11[1]].id=parseInt( document.forms[0].elements[a11[1]].id)+1;

    document.forms[0].elements[a1[0]].id=parseInt(document.forms[0].elements[a1[0]].id)-1;

    document.forms[0].elements[a1[1]].id=parseInt(document.forms[0].elements[a1[1]].id)-1


    var drop_down=document.getElementById("previous_questions")
        var temp_arr1=new Array(2);
        for(i=0;i<drop_down.length;i++){
                        var temp=parseInt(jid);
                        if(drop_down.options[i].value==temp+1){
                                  temp_arr1[0]=i;
                        }
                        if(drop_down.options[i].value==temp){
                                    temp_arr1[1]=i;
                        }
        }
                    drop_down.options[temp_arr1[0]].value=parseInt(drop_down.options[temp_arr1[0]].value)-1;
                    drop_down.options[temp_arr1[1]].value=parseInt(drop_down.options[temp_arr1[1]].value)+1;




}

}

</script>